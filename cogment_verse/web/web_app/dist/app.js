import{a as Se}from"./chunk-UZJZDSBV.js";import{C as X,F as Y,G as C,H as Z,J as Ee,K as he,L as be,U as j,V as D,W as B,X as ee,Z as te,_ as re,a as O,b as U,c as G,d as q,e as J,f as W,fa as oe,g as T,h as V,i as z,j as K,k as E,l as Q,y as I}from"./chunk-NTECEGTZ.js";import{a as v}from"./chunk-ZPRNS4IU.js";import{b as Ce,c as o,d as h}from"./chunk-53HPM5H3.js";var b=Ce(m=>{"use strict";var r;m.__esModule=!0;m.cogSettings=m.EvaluatorActorClass=m.ObserverActorClass=m.TeacherActorClass=m.PlayerActorClass=void 0;var we=Ee(),y=he(),e=be(),se=function(){function t(){this.name="player",this.config=e.cogment_verse.AgentConfig,this.actionSpace=e.cogment_verse.PlayerAction,this.observationSpace=e.cogment_verse.Observation}return t}();m.PlayerActorClass=se;var ne=function(){function t(){this.name="teacher",this.config=e.cogment_verse.AgentConfig,this.actionSpace=e.cogment_verse.TeacherAction,this.observationSpace=e.cogment_verse.Observation}return t}();m.TeacherActorClass=ne;var ae=function(){function t(){this.name="observer",this.config=e.cogment_verse.AgentConfig,this.actionSpace=e.cogment_verse.ObserverAction,this.observationSpace=e.cogment_verse.Observation}return t}();m.ObserverActorClass=ae;var ce=function(){function t(){this.name="evaluator",this.config=e.cogment_verse.AgentConfig,this.actionSpace=e.cogment_verse.EvaluatorAction,this.observationSpace=e.cogment_verse.Observation}return t}();m.EvaluatorActorClass=ce;m.cogSettings={messageUrlMap:(r={},r["type.googleapis.com/cogment_verse.nd_array.Array"]=we.cogment_verse.nd_array.Array,r["type.googleapis.com/cogment_verse.spaces.Discrete"]=y.cogment_verse.spaces.Discrete,r["type.googleapis.com/cogment_verse.spaces.Box"]=y.cogment_verse.spaces.Box,r["type.googleapis.com/cogment_verse.spaces.MultiBinary"]=y.cogment_verse.spaces.MultiBinary,r["type.googleapis.com/cogment_verse.spaces.MultiDiscrete"]=y.cogment_verse.spaces.MultiDiscrete,r["type.googleapis.com/cogment_verse.spaces.Dict"]=y.cogment_verse.spaces.Dict,r["type.googleapis.com/cogment_verse.spaces.Dict.SubSpace"]=y.cogment_verse.spaces.Dict.SubSpace,r["type.googleapis.com/cogment_verse.spaces.Space"]=y.cogment_verse.spaces.Space,r["type.googleapis.com/cogment_verse.nd_array.Array"]=y.cogment_verse.nd_array.Array,r["type.googleapis.com/cogment_verse.EnvironmentSpecs"]=e.cogment_verse.EnvironmentSpecs,r["type.googleapis.com/cogment_verse.EnvironmentConfig"]=e.cogment_verse.EnvironmentConfig,r["type.googleapis.com/cogment_verse.HFHubModel"]=e.cogment_verse.HFHubModel,r["type.googleapis.com/cogment_verse.AgentConfig"]=e.cogment_verse.AgentConfig,r["type.googleapis.com/cogment_verse.TrialConfig"]=e.cogment_verse.TrialConfig,r["type.googleapis.com/cogment_verse.Observation"]=e.cogment_verse.Observation,r["type.googleapis.com/cogment_verse.PlayerAction"]=e.cogment_verse.PlayerAction,r["type.googleapis.com/cogment_verse.TeacherAction"]=e.cogment_verse.TeacherAction,r["type.googleapis.com/cogment_verse.ObserverAction"]=e.cogment_verse.ObserverAction,r["type.googleapis.com/cogment_verse.EvaluatorAction"]=e.cogment_verse.EvaluatorAction,r["type.googleapis.com/cogment_verse.nd_array.Array"]=e.cogment_verse.nd_array.Array,r["type.googleapis.com/cogment_verse.spaces.Discrete"]=e.cogment_verse.spaces.Discrete,r["type.googleapis.com/cogment_verse.spaces.Box"]=e.cogment_verse.spaces.Box,r["type.googleapis.com/cogment_verse.spaces.MultiBinary"]=e.cogment_verse.spaces.MultiBinary,r["type.googleapis.com/cogment_verse.spaces.MultiDiscrete"]=e.cogment_verse.spaces.MultiDiscrete,r["type.googleapis.com/cogment_verse.spaces.Dict"]=e.cogment_verse.spaces.Dict,r["type.googleapis.com/cogment_verse.spaces.Dict.SubSpace"]=e.cogment_verse.spaces.Dict.SubSpace,r["type.googleapis.com/cogment_verse.spaces.Space"]=e.cogment_verse.spaces.Space,r),actorClasses:{player:new se,teacher:new ne,observer:new ae,evaluator:new ce},trial:{config:e.cogment_verse.TrialConfig},environment:{config:e.cogment_verse.EnvironmentConfig,class:{id:"env",config:e.cogment_verse.EnvironmentConfig}}}});var ye=o(h()),Ae=o(Se());var ie=o(h());var le=o(b()),w=o(v()),xe=()=>{let{trialId:t}=G(),s=U(),n=(0,ie.useCallback)(()=>s(".."),[s]),[u,i,A,g,p]=j(le.cogSettings,C,t,5e3);if(i==null)return(0,w.jsx)(ee,{trialId:t,trialStatus:u,actorParams:i,event:A,sendAction:g,trialError:p,onNextTrial:n});let _=i?.config?.environmentSpecs?.implementation||void 0,l=i?.config?.environmentSpecs?.webComponentsFile||void 0;if(_!=null&&l!=null)return(0,w.jsx)(te,{moduleUrl:`${Z}/components/environments/${_}/${l}`,trialId:t,trialStatus:u,actorParams:i,event:A,sendAction:g,trialError:p,onNextTrial:n});if(i?.className===X)return(0,w.jsx)(oe,{trialId:t,trialStatus:u,actorParams:i,event:A,sendAction:g,trialError:p,onNextTrial:n});throw new Error(`No web component defined for environment "${_}"`)},me=xe;var x=o(I()),ge=async(t,s,n=5e3)=>{let i=new x.Context(t,"cogment_verse_web").getController(s),A=!1,g=new Set;return await Promise.race([new Promise(async(p,_)=>{try{for await(let l of i.watchTrials()){if(A){console.log("[retrievePendingTrials] watch trials cancelled");return}l.state===x.TrialState.PENDING?g.add(l.trialId):g.delete(l.trialId)}p([...g])}catch(l){console.log("erroror",l),_(l)}}),new Promise(p=>{setTimeout(()=>{A=!0,p([...g])},n)})])};var pe=o(b());var ve=async()=>{let t=await ge(pe.cogSettings,C,500);return t.length===0?O("/"):O(t[0])};var Ve=o(h());var M=o(v()),Ne=()=>{let t=q();return(0,M.jsx)(re,{title:"Oups...",error:t,children:(0,M.jsx)(Q,{to:"/",reloadDocument:!0,children:"Retry"})})},$=Ne;var F=o(I());var N=o(I()),P=o(h()),Pe=async t=>new Promise(s=>setTimeout(s,t)),ue=(t,s,n=500)=>{let[u,i]=(0,P.useState)([]);return(0,P.useEffect)(()=>{let g=new N.Context(t,"cogment_verse_web").getController(s),p=!1,_=async l=>{let k=g.watchTrials(),R=l*n;try{for await(let f of k){if(p){console.log("[useActiveTrials] watch trials cancelled");return}if(f.state===N.TrialState.ENDED){i(d=>d.filter(({trialId:S})=>S!==f.trialId));continue}i(d=>{let S=d.findIndex(({trialId:Te})=>Te===f.trialId);return S===-1?[...d,{trialId:f.trialId,state:f.state}]:d[S].state!==f.state?(d[S].state=f.state,[...d]):d})}console.warn(`[useActiveTrials] watch trials returned early, restarting in ${R}ms`)}catch(f){console.warn(`[useActiveTrials] error during watch trials (${f}), restarting in ${R}ms`)}await Pe(R),await _(l+1)};return _(0),()=>{p=!0}},[t,s,n]),u};var fe=o(b());var c=o(v()),H=["rounded-md","py-2","px-5","text-center","text-sm","text-white"],Re=({state:t,trialId:s,...n})=>t===F.TrialState.PENDING?(0,c.jsxs)(K,{className:E(H,"bg-emerald-500 hover:bg-emerald-800"),to:`/play/${s}`,...n,children:[(0,c.jsx)(D,{icon:B,shake:!0})," Join pending trial..."]}):t===F.TrialState.RUNNING?(0,c.jsxs)("span",{className:E(H,"bg-slate-600"),...n,children:[(0,c.jsx)(D,{icon:B,spin:!0})," Trial running"]}):(0,c.jsx)("span",{className:E(H,"bg-red-600"),...n,children:t}),Oe=()=>{let t=ue(fe.cogSettings,C);return(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"text-xl font-semibold mt-5",children:"Active trials"}),(0,c.jsx)("ul",{className:"my-5 flex flex-col",children:t.map(({trialId:s,state:n},u)=>(0,c.jsxs)("li",{className:E("flex flex-row items-center p-2",{"bg-slate-100":u%2===0}),children:[(0,c.jsx)("div",{className:"grow font-medium font-mono",children:s}),(0,c.jsx)(Re,{state:n,trialId:s})]},u))})]})},_e=Oe;var L=o(v()),Ie=()=>(0,L.jsx)("div",{className:"max-w-screen-xl mx-auto min-h-fit",children:(0,L.jsx)(W,{})}),de=Ie;var a=o(v()),De=z(V((0,a.jsxs)(T,{path:"/",element:(0,a.jsx)(de,{}),children:[(0,a.jsx)(T,{index:!0,element:(0,a.jsx)(_e,{}),errorElement:(0,a.jsx)($,{})}),(0,a.jsxs)(T,{path:"play",errorElement:(0,a.jsx)($,{}),children:[(0,a.jsx)(T,{index:!0,loader:ve}),(0,a.jsx)(T,{path:":trialId",element:(0,a.jsx)(me,{})})]})]}))),Be=(0,Ae.createRoot)(document.getElementById("root"));Be.render((0,a.jsx)(ye.default.StrictMode,{children:(0,a.jsx)(J,{router:De})}));
//# sourceMappingURL=app.js.map
