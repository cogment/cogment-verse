import{a as lt}from"./chunk-UZJZDSBV.js";import{F as E,G as J,R as C,S,V as q,W as z,a as h,b as D,c as O,d as k,e as G,f as $,g as f,h as U,i as F,j as H,k as T,l as M,y as W,z as P}from"./chunk-7KYADHUY.js";import{a as i}from"./chunk-ZPRNS4IU.js";import{c as t,d as v}from"./chunk-53HPM5H3.js";var ot=t(v()),nt=t(lt());var K=t(v());var V=t(i()),st=()=>{let{trialId:e}=O(),r=D(),a=(0,K.useCallback)(()=>r(".."),[r]);return(0,V.jsx)(q,{moduleUrl:`${J}/components/environments/environments.gym.environment.Environment/LunarLander-v2/GymLunarLander.js`,trialId:e,onTrialEnd:a})},Q=st;var x=t(P()),X=async(e,r,a=5e3)=>{let w=new x.Context(e,"cogment_verse_web").getController(r),R=!1,c=new Set;return await Promise.race([new Promise(async(d,g)=>{try{for await(let l of w.watchTrials()){if(R){console.log("[retrievePendingTrials] watch trials cancelled");return}l.state===x.TrialState.PENDING?c.add(l.trialId):c.delete(l.trialId)}d([...c])}catch(l){console.log("erroror",l),g(l)}}),new Promise(d=>{setTimeout(()=>{R=!0,d([...c])},a)})])};var Y=t(W());var Z=async()=>{let e=await X(Y.cogSettings,E,500);return e.length===0?h("/"):h(e[0])};var Ct=t(v());var A=t(i()),mt=()=>{let e=k();return(0,A.jsx)(z,{title:"Oups...",error:e,children:(0,A.jsx)(M,{to:"/",reloadDocument:!0,children:"Retry"})})},_=mt;var B=t(P());var y=t(P()),N=t(v()),ct=async e=>new Promise(r=>setTimeout(r,e)),j=(e,r,a=500)=>{let[p,w]=(0,N.useState)([]);return(0,N.useEffect)(()=>{let c=new y.Context(e,"cogment_verse_web").getController(r),d=!1,g=async l=>{let at=c.watchTrials(),I=l*a;try{for await(let s of at){if(d){console.log("[useActiveTrials] watch trials cancelled");return}if(s.state===y.TrialState.ENDED){w(m=>m.filter(({trialId:u})=>u!==s.trialId));continue}w(m=>{let u=m.findIndex(({trialId:it})=>it===s.trialId);return u===-1?[...m,{trialId:s.trialId,state:s.state}]:m[u].state!==s.state?(m[u].state=s.state,[...m]):m})}console.warn(`[useActiveTrials] watch trials returned early, restarting in ${I}ms`)}catch(s){console.warn(`[useActiveTrials] error during watch trials (${s}), restarting in ${I}ms`)}await ct(I),await g(l+1)};return g(0),()=>{d=!0}},[e,r,a]),p};var tt=t(W());var n=t(i()),b=["rounded-md","py-2","px-5","text-center","text-sm","text-white"],dt=({state:e,trialId:r,...a})=>e===B.TrialState.PENDING?(0,n.jsxs)(H,{className:T(b,"bg-emerald-500 hover:bg-emerald-800"),to:`/play/${r}`,...a,children:[(0,n.jsx)(C,{icon:S,shake:!0})," Join pending trial..."]}):e===B.TrialState.RUNNING?(0,n.jsxs)("span",{className:T(b,"bg-slate-600"),...a,children:[(0,n.jsx)(C,{icon:S,spin:!0})," Trial running"]}):(0,n.jsx)("span",{className:T(b,"bg-red-600"),...a,children:e}),ft=()=>{let e=j(tt.cogSettings,E);return(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-xl font-semibold mt-5",children:"Active trials"}),(0,n.jsx)("ul",{className:"my-5 flex flex-col",children:e.map(({trialId:r,state:a},p)=>(0,n.jsxs)("li",{className:T("flex flex-row items-center p-2",{"bg-slate-100":p%2===0}),children:[(0,n.jsx)("div",{className:"grow font-medium font-mono",children:r}),(0,n.jsx)(dt,{state:a,trialId:r})]},p))})]})},et=ft;var L=t(i()),pt=()=>(0,L.jsx)("div",{className:"max-w-screen-xl mx-auto min-h-fit",children:(0,L.jsx)($,{})}),rt=pt;var o=t(i()),ut=F(U((0,o.jsxs)(f,{path:"/",element:(0,o.jsx)(rt,{}),children:[(0,o.jsx)(f,{index:!0,element:(0,o.jsx)(et,{}),errorElement:(0,o.jsx)(_,{})}),(0,o.jsxs)(f,{path:"play",errorElement:(0,o.jsx)(_,{}),children:[(0,o.jsx)(f,{index:!0,loader:Z}),(0,o.jsx)(f,{path:":trialId",element:(0,o.jsx)(Q,{})})]})]}))),Tt=(0,nt.createRoot)(document.getElementById("root"));Tt.render((0,o.jsx)(ot.default.StrictMode,{children:(0,o.jsx)(G,{router:ut})}));
//# sourceMappingURL=app.js.map
