{
  "version": 3,
  "sources": ["../MountainCar.jsx"],
  "sourcesContent": ["// Copyright 2023 AI Redefined Inc. <dev+cogment@ai-r.com>\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { useCallback, useState } from \"react\";\nimport {\n  useDocumentKeypressListener,\n  usePressedKeys,\n  PlayObserver,\n  useRealTimeUpdate,\n  TEACHER_ACTOR_CLASS,\n  OBSERVER_ACTOR_CLASS,\n  DPad,\n  useDPadPressedButtons,\n  DPAD_BUTTONS,\n  Button,\n  FpsCounter,\n  KeyboardControlList,\n  serializePlayerAction,\n  TEACHER_NOOP_ACTION,\n  Space,\n  SimplePlay,\n} from \"@cogment/cogment-verse\";\n\nconst DEACTIVATED_BUTTONS_TEACHER = [DPAD_BUTTONS.UP];\nconst DEACTIVATED_BUTTONS_PLAYER = [DPAD_BUTTONS.UP, DPAD_BUTTONS.DOWN];\nconst ACTION_SPACE = new Space({\n  discrete: {\n    n: 3,\n  },\n});\n\nexport const MountainCarControls = ({ sendAction, fps = 30, actorParams, ...props }) => {\n  const actorClassName = actorParams?.className;\n\n  const isTeacher = actorClassName === TEACHER_ACTOR_CLASS;\n  const [paused, setPaused] = useState(false);\n  const togglePause = useCallback(() => setPaused((paused) => !paused), [setPaused]);\n  useDocumentKeypressListener(\"p\", togglePause);\n\n  const pressedKeys = usePressedKeys();\n  const { pressedButtons, isButtonPressed, setPressedButtons } = useDPadPressedButtons();\n  const [activeButtons, setActiveButtons] = useState([]);\n\n  const computeAndSendAction = useCallback(\n    (dt) => {\n      if (pressedKeys.has(\"ArrowLeft\") || isButtonPressed(DPAD_BUTTONS.LEFT)) {\n        setActiveButtons([DPAD_BUTTONS.LEFT]);\n        sendAction(serializePlayerAction(ACTION_SPACE, 0));\n      } else if (pressedKeys.has(\"ArrowRight\") || isButtonPressed(DPAD_BUTTONS.RIGHT)) {\n        setActiveButtons([DPAD_BUTTONS.RIGHT]);\n        sendAction(serializePlayerAction(ACTION_SPACE, 2));\n      } else if (isTeacher) {\n        if (pressedKeys.has(\"ArrowDown\") || isButtonPressed(DPAD_BUTTONS.DOWN)) {\n          setActiveButtons([DPAD_BUTTONS.DOWN]);\n          sendAction(serializePlayerAction(ACTION_SPACE, 1));\n        } else {\n          setActiveButtons([]);\n          sendAction(TEACHER_NOOP_ACTION);\n        }\n      } else {\n        setActiveButtons([]);\n        sendAction(serializePlayerAction(ACTION_SPACE, 1));\n      }\n    },\n    [isButtonPressed, isTeacher, pressedKeys, sendAction]\n  );\n\n  const { currentFps } = useRealTimeUpdate(computeAndSendAction, fps, paused);\n\n  return (\n    <div {...props}>\n      <div className=\"flex flex-row p-5 justify-center\">\n        <DPad\n          pressedButtons={pressedButtons}\n          onPressedButtonsChange={setPressedButtons}\n          activeButtons={activeButtons}\n          disabled={paused || (isTeacher ? DEACTIVATED_BUTTONS_TEACHER : DEACTIVATED_BUTTONS_PLAYER)}\n        />\n      </div>\n      <div className=\"flex flex-row gap-1\">\n        <Button className=\"flex-1\" onClick={togglePause}>\n          {paused ? \"Resume\" : \"Pause\"}\n        </Button>\n        <FpsCounter className=\"flex-none w-fit\" value={currentFps} />\n      </div>\n      <KeyboardControlList\n        items={[\n          [\"Left/Right Arrows\", \"Accelerate to the left/right\"],\n          isTeacher ? [\"Down Arrow\", \"Don't accelerate\"] : null,\n          [\"p\", \"Pause/Unpause\"],\n        ]}\n      />\n    </div>\n  );\n};\n\nconst PlayMountainCar = ({ actorParams, ...props }) => {\n  const actorClassName = actorParams?.className;\n\n  if (actorClassName === OBSERVER_ACTOR_CLASS) {\n    return <PlayObserver actorParams={actorParams} {...props} />;\n  }\n  return <SimplePlay actorParams={actorParams} {...props} controls={MountainCarControls} />;\n};\n\nexport default PlayMountainCar;\n"],
  "mappings": "AAcA,OAAS,eAAAA,EAAa,YAAAC,MAAgB,QACtC,OACE,+BAAAC,EACA,kBAAAC,EACA,gBAAAC,EACA,qBAAAC,EACA,uBAAAC,EACA,wBAAAC,EACA,QAAAC,EACA,yBAAAC,EACA,gBAAAC,EACA,UAAAC,EACA,cAAAC,EACA,uBAAAC,EACA,yBAAAC,EACA,uBAAAC,EACA,SAAAC,EACA,cAAAC,MACK,yBAmDC,cAAAC,EAOF,QAAAC,MAPE,oBAjDR,IAAMC,EAA8B,CAACV,EAAa,EAAE,EAC9CW,EAA6B,CAACX,EAAa,GAAIA,EAAa,IAAI,EAChEY,EAAe,IAAIN,EAAM,CAC7B,SAAU,CACR,EAAG,CACL,CACF,CAAC,EAEYO,EAAsB,CAAC,CAAE,WAAAC,EAAY,IAAAC,EAAM,GAAI,YAAAC,EAAa,GAAGC,CAAM,IAAM,CAGtF,IAAMC,EAFiBF,GAAa,YAECpB,EAC/B,CAACuB,EAAQC,CAAS,EAAI7B,EAAS,EAAK,EACpC8B,EAAc/B,EAAY,IAAM8B,EAAWD,GAAW,CAACA,CAAM,EAAG,CAACC,CAAS,CAAC,EACjF5B,EAA4B,IAAK6B,CAAW,EAE5C,IAAMC,EAAc7B,EAAe,EAC7B,CAAE,eAAA8B,EAAgB,gBAAAC,EAAiB,kBAAAC,CAAkB,EAAI1B,EAAsB,EAC/E,CAAC2B,EAAeC,CAAgB,EAAIpC,EAAS,CAAC,CAAC,EAE/CqC,EAAuBtC,EAC1BuC,GAAO,CACFP,EAAY,IAAI,WAAW,GAAKE,EAAgBxB,EAAa,IAAI,GACnE2B,EAAiB,CAAC3B,EAAa,IAAI,CAAC,EACpCc,EAAWV,EAAsBQ,EAAc,CAAC,CAAC,GACxCU,EAAY,IAAI,YAAY,GAAKE,EAAgBxB,EAAa,KAAK,GAC5E2B,EAAiB,CAAC3B,EAAa,KAAK,CAAC,EACrCc,EAAWV,EAAsBQ,EAAc,CAAC,CAAC,GACxCM,EACLI,EAAY,IAAI,WAAW,GAAKE,EAAgBxB,EAAa,IAAI,GACnE2B,EAAiB,CAAC3B,EAAa,IAAI,CAAC,EACpCc,EAAWV,EAAsBQ,EAAc,CAAC,CAAC,IAEjDe,EAAiB,CAAC,CAAC,EACnBb,EAAWT,CAAmB,IAGhCsB,EAAiB,CAAC,CAAC,EACnBb,EAAWV,EAAsBQ,EAAc,CAAC,CAAC,EAErD,EACA,CAACY,EAAiBN,EAAWI,EAAaR,CAAU,CACtD,EAEM,CAAE,WAAAgB,CAAW,EAAInC,EAAkBiC,EAAsBb,EAAKI,CAAM,EAE1E,OACEV,EAAC,OAAK,GAAGQ,EACP,UAAAT,EAAC,OAAI,UAAU,mCACb,SAAAA,EAACV,EAAA,CACC,eAAgByB,EAChB,uBAAwBE,EACxB,cAAeC,EACf,SAAUP,IAAWD,EAAYR,EAA8BC,GACjE,EACF,EACAF,EAAC,OAAI,UAAU,sBACb,UAAAD,EAACP,EAAA,CAAO,UAAU,SAAS,QAASoB,EACjC,SAAAF,EAAS,SAAW,QACvB,EACAX,EAACN,EAAA,CAAW,UAAU,kBAAkB,MAAO4B,EAAY,GAC7D,EACAtB,EAACL,EAAA,CACC,MAAO,CACL,CAAC,oBAAqB,8BAA8B,EACpDe,EAAY,CAAC,aAAc,kBAAkB,EAAI,KACjD,CAAC,IAAK,eAAe,CACvB,EACF,GACF,CAEJ,EAEMa,EAAkB,CAAC,CAAE,YAAAf,EAAa,GAAGC,CAAM,IACxBD,GAAa,YAEbnB,EACdW,EAACd,EAAA,CAAa,YAAasB,EAAc,GAAGC,EAAO,EAErDT,EAACD,EAAA,CAAW,YAAaS,EAAc,GAAGC,EAAO,SAAUJ,EAAqB,EAGlFmB,EAAQD",
  "names": ["useCallback", "useState", "useDocumentKeypressListener", "usePressedKeys", "PlayObserver", "useRealTimeUpdate", "TEACHER_ACTOR_CLASS", "OBSERVER_ACTOR_CLASS", "DPad", "useDPadPressedButtons", "DPAD_BUTTONS", "Button", "FpsCounter", "KeyboardControlList", "serializePlayerAction", "TEACHER_NOOP_ACTION", "Space", "SimplePlay", "jsx", "jsxs", "DEACTIVATED_BUTTONS_TEACHER", "DEACTIVATED_BUTTONS_PLAYER", "ACTION_SPACE", "MountainCarControls", "sendAction", "fps", "actorParams", "props", "isTeacher", "paused", "setPaused", "togglePause", "pressedKeys", "pressedButtons", "isButtonPressed", "setPressedButtons", "activeButtons", "setActiveButtons", "computeAndSendAction", "dt", "currentFps", "PlayMountainCar", "MountainCar_default"]
}
